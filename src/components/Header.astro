---
import { GLOBAL } from "../lib/variables";
import Anchor from "./common/Anchor.astro";
---

<header class="bg-white border-b-brutal sticky top-0 w-full z-50 transition-colors">
  <!-- Mobile hamburger -->
  <div class="md:hidden relative z-50 py-4 px-4 flex items-center justify-between border-b-brutal-thin">
    <button
      id="mobile-menu-toggle"
      class="p-2 border-brutal-thin hover:bg-sage transition-colors"
      aria-label="Toggle navigation menu"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 512 512"
        class="fill-current"
      >
        <path d="M80 96h352v32H80zm0 144h352v32H80zm0 144h352v32H80z"></path>
      </svg>
    </button>
    <span class="text-xs uppercase tracking-wider font-bold">Menu</span>
  </div>

  <!-- Desktop nav -->
  <nav
    id="main-nav"
    class="fixed md:relative inset-x-0 top-0 bg-white border-b-brutal md:border-none
           transform -translate-y-full md:translate-y-0 transition-transform duration-300
           md:px-0 flex flex-col md:flex-row justify-between items-start md:items-center
           gap-8 md:gap-0 py-8 md:py-4 px-4 max-w-5xl mx-auto mt-16 md:mt-0 z-40"
  >
    <!-- Menu items -->
    <div class="flex flex-col md:flex-row gap-6 md:gap-8 font-medium text-lg md:text-base">
      {
        Object.entries(GLOBAL.menu).map((item) => (
          <Anchor url={item[1]} class="uppercase tracking-wide hover:text-sage-dark transition-colors">
            {item[0]}
          </Anchor>
        ))
      }
    </div>

    <!-- Social icons + theme toggle -->
    <div class="flex gap-4 items-center">
      {GLOBAL.rss && (
        <Anchor
          url={GLOBAL.rss}
          aria-label="RSS Feed"
          class="p-2 border-brutal-thin hover:bg-sage hover:border-sage transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            class="fill-current"
          >
            <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C4.98 20 4 19.02 4 17.82a2.18 2.18 0 0 1 2.18-2.18zM4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44zM4 10.1A9.9 9.9 0 0 1 13.9 20h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z" />
          </svg>
        </Anchor>
      )}

      {GLOBAL.email && (
        <Anchor
          url={`mailto:${GLOBAL.email}`}
          aria-label="Email Ryan Mavilia"
          class="p-2 border-brutal-thin hover:bg-sage hover:border-sage transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            class="fill-current"
          >
            <path d="M12 13.5L2 6.75V18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6.75L12 13.5zm0-2.25L22 4H2l10 7.25z" />
          </svg>
        </Anchor>
      )}

      {GLOBAL.githubProfile && (
        <Anchor
          url={GLOBAL.githubProfile}
          aria-label="GitHub Profile"
          class="p-2 border-brutal-thin hover:bg-sage hover:border-sage transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            class="fill-current"
          >
            <path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2" />
          </svg>
        </Anchor>
      )}
    </div>
  </nav>
</header>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const nav = document.getElementById('main-nav');
  let isOpen = false;

  function updateNavState() {
    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    if (isMobile && nav) {
      nav.style.transform = isOpen ? "translateY(0)" : "translateY(-100%)";
    } else if (nav) {
      nav.style.transform = "translateY(0)";
      isOpen = false;
    }
  }

  function toggleNav() {
    isOpen = !isOpen;
    updateNavState();
  }

  toggle?.addEventListener("click", toggleNav);
  window.addEventListener("resize", updateNavState);

  // Close menu on navigation
  document.addEventListener('astro:page-load', () => {
    isOpen = false;
    updateNavState();
  });

  updateNavState();
</script>
